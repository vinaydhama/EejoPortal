<!DOCTYPE html>
<html lang="en">

<head>

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Swimming Event Entry</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    .container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-width: 700px;
    }

    .flex-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .flex-col {
      display: flex;
      flex-direction: column;
      gap: 5px;
      flex: 1;
    }

    label {
      font-weight: bold;
    }

    input,
    select,
    textarea {
      padding: 8px;
      width: 100%;
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }

    th {
      background-color: #f2f2f2;
      color: #333;
    }

    tr:nth-child(even) {
      background-color: #f9f9f9;
    }

    tr:hover {
      background-color: #e9e9e9;
    }

    button {
      padding: 10px;
      background-color: #0078D4;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #005A9E;
    }

    .hidden {
      display: none;
    }
  </style>
  <script type="module" src="../js/AddSwimmerRecord.js"></script>
  <script  src="../js/Utility.js"></script>

  <script src="../js/script.js"></script>
  <script src="../js/GraphVisuliser.js"></script>


  <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"> </script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

  

</head>

<body>

  <div class="container">

    <!-- Event Type -->
    <div id="SwimmerPerformance" class="tabcontent">
      <h3>Swimmer Performance Report</h3>
      <div class="flex-row " style="display: block;">
        <table id="performanceTable" class="table">
          <thead>
            <tr>
              <th id="SlNoTh">Sl.No</th>
              <th id="Rankth">Rank</th>

              <!-- <th id="SwimmerIDth" onclick="sortTable(0)">Swimmer ID</th> -->
              <th id="EventIDth" onclick="sortTable(1)">Event ID</th>
              <th id="HeatDateTimeth" onclick="sortTable(1)">Heat DateTime</th>

              <th id="Stroketh" onclick="sortTable(3)">Stroke</th>
              <th id="Distanceth" onclick="sortTable(4)">Distance</th>
              <th id="Timeth" onclick="sortTable(2)">Time</th>

              <th id="GoodThingsth" onclick="sortTable(5)">Good Things</th>
              <th id="ToImproveth" onclick="sortTable(6)">To Improve</th>
              <!-- <th>Actions</th> -->
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <button id='ShowAddRecord' onclick="{document.getElementById('AddRecodeddiv').style.display='block'}">+</button>
      <button id='ShowAddRecord' onclick="{document.getElementById('filters').style.display='block'}">Filter</button>     

        <!-- <button id="ShowAddRecord" onclick="document.getElementById('Graphsection').style.display='block'; plotVisualiser();">
          Graph
        </button> -->

        <button id="ShowAddRecord" onclick=" plotVisualiser();">
          Graph
        </button>


      <div id="AddRecodeddiv" style="display: none;">
        <div class="flex-col">
          <label for="eventType">Event Type</label>
          <select id="eventType">
            <option value="Training">Training</option>
            <option value="Club">Club Level</option>
            <option value="Interschool">Interschool</option>
            <option value="State">State</option>
            <option value="National">National</option>
          </select>
        </div>

        <!-- Event Details (shown if not Training) -->
        <div id="eventDetails" class="hidden">
          <div class="flex-col">
            <label for="eventNameDropdown">Event Name</label>
            <select id="eventNameDropdown">
              <option value="">-- Select Existing Event --</option>
            </select>
          </div>

          <div class="flex-col">
            <label for="newEventName">New Event Name (if not found)</label>
            <input type="text" id="newEventName" placeholder="Enter new event name">
          </div>

          <div class="flex-col">
            <label for="eventDate">Event Date</label>
            <input type="date" id="eventDate">
          </div>

          <div class="flex-col">
            <label for="eventAddress">Event Address</label>
            <textarea id="eventAddress" rows="3"></textarea>
          </div>

          <div class="flex-col">
            <label for="eventLocation">Event GPS Location</label>
            <input type="text" id="eventLocation" placeholder="Latitude, Longitude">
          </div>

          <div class="flex-col">
            <button id="addEventButton" class="hidden">Add New Event</button>
          </div>
        </div>

        <!-- Swimmer Info -->
        <div class="flex-row">
          <div class="flex-col">
            <label for="swimmerId">Swimmer ID</label>
            <input type="text" id="swimmerId" value="SESSION_SWIMMER_ID" readonly>
          </div>
          <div class="flex-col">
            <label for="swimmerName">Swimmer Name</label>
            <input type="text" id="swimmerName" value="SESSION_SWIMMER_NAME" readonly>
          </div>
        </div>


        <!-- Performance Entry -->
        <div class="flex-row">
          <div class="flex-col">
            <label for="strokeType">Stroke Type</label>
            <select id="strokeType">
              <option value="Freestyle">Freestyle</option>
              <option value="Breaststroke">Breaststroke</option>
              <option value="Butterfly">Butterfly</option>
              <option value="Backstroke">Backstroke</option>
            </select>
            
            
          </div>

          <div class="flex-col">
            <label for="distance">Distance</label>
            <select id="distance">
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
              <option value="200">200</option>
              <option value="400">400</option>
              <option value="800">800</option>
              <option value="Other">Other</option>
            </select>
            <input type="text" id="customDistance" class="hidden" placeholder="Enter custom distance">
          </div>
        </div>

        <div class="flex-col">
          <label for="HeatDateTime">Heat DateTime</label>
          <input type="datetime-local" id="HeatDateTime" placeholder="e.g., 01:23.456">

          <label for="recordTime">Timings</label>
          <input type="text" id="recordTime" placeholder="e.g., 01:23.456">
          
          <label for="rankentry">Rank</label>
          <input type="text" id="rankentry" placeholder="01">
        </div>

        <button id="AddRecordbtn">Add Record</button>
        <button id="CancelAddRecordbtn"
          onclick="{document.getElementById('AddRecodeddiv').style.display='none'}">Cancel</button>

      </div>
      <div id="Graphsection" style="display: none;">
        <h3>Select Axes</h3>
        <label for="xSelect">X-axis:</label>
        <select id="xSelect"></select>
        <label for="ySelect">Y-axis:</label>
        <select id="ySelect"></select>
        <button onclick="plotGraph()">Plot Graph</button>
        <button onclick="generatePDF()">Download PDF</button>

        
        <div id="chartContainer">
          <canvas id="chartCanvas" >
            <h2>Visualizations</h2>
            
          </canvas>
        </div>
      </div>

      <div id="filters" style="display: none;">
        <input type="text" id="filterSwimmerId" placeholder="Filter by Swimmer ID" onkeyup="filterTable()" />
        <input type="text" id="filterEventId" placeholder="Filter by Event ID" onkeyup="filterTable()" />
        <input type="text" id="filterStroke" placeholder="Filter by Stroke" onkeyup="filterTable()" />
        <input type="text" id="filterDistance" placeholder="Filter by Distance" onkeyup="filterTable()" />
        <!-- <button  id='ShowAddRecord' onclick="{document.getElementById('filters').style.display='block'}">Filter</button> -->
        <button id="ResetFilter" onclick="{document.getElementById('filters').style.display='none'}">Reset</button>
      </div>


    </div>
  </div>

  <div class="flex-row ">
    <table id="performanceTable" class="table">
      <thead>
        <tr>
          <th id="SlNoTh" >Sl.No</th>
          <th id="Rankth" >Rank</th>


          <!-- <th id="SwimmerIDth" onclick="sortTable(0)">Swimmer ID</th> -->
          <th id="EventIDth" onclick="sortTable(1)">Event ID</th>
          <th id="HeatDateTimeth" onclick="sortTable(1)">Heat DateTime</th>

          <th id="Stroketh" onclick="sortTable(3)">Stroke</th>
          <th id="Distanceth" onclick="sortTable(4)">Distance</th>
          <th id="Timeth" onclick="sortTable(2)">Time</th>
          
          <th id="GoodThingsth" onclick="sortTable(5)">Good Things</th>
          <th id="ToImproveth" onclick="sortTable(6)">To Improve</th>
          <!-- <th>Actions</th> -->
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="chartVis"></div>
    
  </div>
  <script>
    // let SwID = "";
   

    function populateDropdowns() {
      const headers = Array.from(document.querySelectorAll('#performanceTable thead th')).map(th => th.textContent);
      const xSelect = document.getElementById('xSelect');
      const ySelect = document.getElementById('ySelect');
      xSelect.innerHTML = '';
      ySelect.innerHTML = '';

      headers.forEach((header, index) => {
        const optionX = document.createElement('option');
        optionX.value = index;
        optionX.text = header;
        xSelect.appendChild(optionX);

        const optionY = document.createElement('option');
        optionY.value = index;
        optionY.text = header;
        ySelect.appendChild(optionY);
      });
    }
    populateDropdowns();
    let chartInstance;

    function plotGraph()
    {

    }
    // function plotGraph() {
    //   const xIndex = parseInt(document.getElementById('xSelect').value);
    //   const yIndex = parseInt(document.getElementById('ySelect').value);

    //   const rows = Array.from(document.querySelectorAll('#performanceTable tbody tr'));
    //   const labels = rows.map(row => row.cells[xIndex].textContent);
    //   const data = rows.map(row => parseFloat(row.cells[yIndex].textContent));

    //   const ctx = document.getElementById('chartCanvas').getContext('2d');
    //   if (chartInstance) chartInstance.destroy(); // Clear previous chart

    //   chartInstance = new Chart(ctx, {
    //     type: 'line',
    //     data: {
    //       labels: labels,
    //       datasets: [{
    //         label: `${document.querySelectorAll('#performanceTable thead th')[yIndex].textContent} vs ${document.querySelectorAll('#performanceTable thead th')[xIndex].textContent}`,
    //         data: data,
    //         borderColor: 'green',
    //         backgroundColor: 'rgba(0, 128, 0, 0.1)',
    //         fill: true
    //       }]
    //     },
    //     options: {
    //       responsive: true,
    //       scales: {
    //         x: { title: { display: true, text: document.querySelectorAll('#performanceTable thead th')[xIndex].textContent } },
    //         y: { title: { display: true, text: document.querySelectorAll('#performanceTable thead th')[yIndex].textContent } }
    //       }
    //     }
    //   });
    // }

    async function generatePDF() {
      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF();

      // Capture table
      const table = document.getElementById('performanceTable');
      const tableCanvas = await html2canvas(table);
      const tableImg = tableCanvas.toDataURL('image/png');
      pdf.text("Monthly Sales and Profit Table", 10, 10);
      pdf.addImage(tableImg, 'PNG', 10, 20, 180, 0);

      // Capture chart
      const chart = document.getElementById('chartContainer');
      const chartCanvas = await html2canvas(chart);
      const chartImg = chartCanvas.toDataURL('image/png');
      pdf.addPage();
      pdf.text("Sales and Profit Chart", 10, 10);
      pdf.addImage(chartImg, 'PNG', 10, 20, 180, 0);

      pdf.save("table_and_chart.pdf");
    }



    
  </script>
</body>
<script>
  let user = ReadSessionData("user")
  if (user)
  {
    UpdateProfilePage(user);
  }
</script>
</html>