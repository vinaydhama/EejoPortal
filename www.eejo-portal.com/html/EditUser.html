<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <title>Edit User</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/AdoptiveStyle.css">
  <!-- <link rel="stylesheet" href="../css/Idcard.css"> -->
  <!-- <link rel="stylesheet" href="../css/GeneralStyle.css"> -->
  <link rel="stylesheet" href="../css/FitForm.css">
  <link rel="stylesheet" href="../css/Pop.css">
  <link rel="stylesheet" href="../css/Slider.css">
  <link rel="stylesheet" href="../css/PhotoCrop.css">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  


  <script src="../js/script.js" defer></script>
  <script src="../js/Pop.js" defer></script>

  <script type="module" src="../js/UserRegistration.js" defer></script>
  <!-- <script type="module" src="../js/PhotoCrop.js" defer></script> -->

  <script src="../js/IDHelper.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cropperjs@1.5.13/dist/cropper.min.js"></script>

</head>

<body>
  <header>
    <div class="profile" onclick="">
      <div class="dark-mode-toggle">

        <img src="../images/profile.jpg" alt="Profile" id="UserPhoto" onclick="toggleProfilePopup()">
        <div class="profile-popup" id="profilePopup">
          <label id="lblUserName"> </label>
          <a href="EditUser.html">Edit Profile</a>
          <a onclick="{ openPrintWindow('UserID',user,'EejoIDcardDisp','') }">Download ID</a>
          <a href="../index.html">Logout</a>
        </div>
      </div>
    </div>
    <div class="logo" >
      <button class="toggle-sidebar" onclick="toggleSidebar()">â˜°</button>
      <img src="../images/eejo_max.png" style="height:100px; margin-top: 0px;">
      <h1 style="align-items:start; text-align: left; margin: 5%;">
        <b> Eejo <br>
          Swim Portal</b>
      </h1>
    </div>

    <label aria-disabled="true" class="dark-mode-toggle" onclick="toggleDarkMode()"> ðŸŒ— </label>

  </header>
  <div class="sidebar" id="sidebar">
    <button onclick="location.href='Home.html'"> Home</button>
    <button onclick="location.href='event_registration.html'"> Event Registration</button>
    <button onclick="location.href='password_recovery.html'"> Password Recovery</button>
    <button onclick="location.href='reports.html'"> Reports</button>
  </div>
  <div class="container">
    <!-- <div class="grid"> -->
      <h1>Edit Profile</h1>
      <div id="preview" style="width: 300px; height: 300px;">
        <img id="image" style="display:block;" src="../images/eejo_BW.png" />
      </div>

    <form id="updateForm">

      <label>Swimmer ID:
        <input type="text" disabled="true" id="swimmer_id" required>
      </label>
      <label>Name:
        <input type="text" id="name" disabled="true" required>
      </label>
      <label>Email:
        <input type="email" id="email">
      </label>

      <label>Date of Birth:
        <input type="date" id="dob" required>
      </label>
      <label>Gender:
        <select id="gender" required>
          <option value="1">Male</option>
          <option value="2">Female</option>
          <option value="3">Other</option>
        </select>
      </label>
      <label>Phone:
        <input type="tel" id="phone">
      </label>
      <label>School Name:
        <input type="text" id="schoolname">
      </label>
      <label>Club Name:
        <input type="text" id="clubname">
      </label>
      <label>Password:
        <input type="password" id="password" required>
      </label>
      <label>Re-enter Password:
        <input type="password" id="confirmPassword" required>
      </label>
      <label>Role:
        <select id="role" disabled>
          <option value="1">Swimmer</option>
          <option value="2">Parent</option>
          <option value="3">Coach</option>
        </select>
      </label>

      <label>Photo Upload: </label>
        <img id="UploadedPhoto" style="margin-left:45%" width=100PX src="../images/profile.jpg">
        <input type="file" id="photoFile" accept="image/*">
      
      

        <div class="controls">
          <button type="button" onclick="cropImage()">Crop & Upload</button>
          <button  type="button" onclick="resetCrop()">Reset</button>
        </div>
        <progress id="photoProgress" value="0" max="100" style="width: 100%;"></progress>
        <div id="photoPreview"></div>
      </label>

      <label>ID1 Upload:
        <img id="UploadedID1" style="margin-left:50%" width=100PX src="../images/profile.jpg">
        <input type="file" id="id1File" accept="image/*">
        <progress id="id1Progress" value="0" max="100" style="width: 100%;"></progress>
        <div id="id1Preview"></div>
      </label>

      <label>ID2 Upload:
        <img id="UploadedID2" style="margin-left:50%" width=100PX src="../images/profile.jpg">
        <input type="file" id="id2File" accept="image/*">
        <progress id="id2Progress" value="0" max="100" style="width: 100%;"></progress>
        <div id="id2Preview"></div>
      </label>
      <button type="submit" onclick="EditSwimmer(event)">Update</button>
    </form>
    <!-- </div> -->
  </div>

  <div id="EejoIDcardDisp" class="id-card" style="display: none; color: black; background-color: rgb(219, 215, 247);">
    <img id="ProfileImg" src="../images/profile.jpg" alt="User Photo" class="photo">
    <h2 id="name">Vinay C.R.</h2>
    <p><strong>ID:</strong> <span id="Eid">EJ123456</span></p>
    <p><strong>DOB:</strong> <span id="Edob">2005-08-17</span></p>
    <p><strong>Gender:</strong> <span id="Egender">Male</span></p>
    <p><strong>Mobile:</strong> <span id="Emobile">+1234567890</span></p>
    <p><strong>Club:</strong> <span id="Eclub">Eejo Swim sdsdsdsdsssdClub</span></p>
    <p><strong>School:</strong> <span id="Eschool">Springfieldasasasasasa sasasasasa High</span></p>
    <canvas id="EejoQRCodeDisp" alt="QR Code" class="qr">
    </canvas>
    <button onclick="DownloadIDcard('EejoIDcardDisp',user.name +'_Eejo')">Download ID Card</button>
  </div>
  <footer>
    <p>&copy; 2025 <a href="www.g.com">Tiny Techniques</a> v 1.0.002</p>
  </footer>

 
  <div class="overlay" id="overlaypop" >
    <div class="Msgpopup" id="ActivityPop">
        <img id="Ejogo" style="margin: 20%;" class="EejoLogo" src="../images/eejo_max.png" alt="WWW.TinyTechniques.com">
      <i class="fa fa-circle-o-notch fa-spin" style="font-size:64px;color: cornflowerblue;"></i>
      <h4 id="BusyPopMsg"><b> </b></h1>
    </div>

    <div class="Msgpopup" id="MessagePop">
      <h1 style="column-fill: auto; color: white; background-color: rgb(22, 1, 211); text-align: justify;">Eejo portal </h1>
      <p class="SlideP" id="popupMessage"></p>
      <button class="Cancelbtn" onclick="ClearAllPop()">Close</button>
    </div>
  </div>

</body>

<script>

  document.addEventListener("DOMContentLoaded", function () {

    // document.getElementById('overlaypop2').classList.add('show');
    let user = ReadSessionData('user');
    if (user) {
      UpdateProfilePage(user);
      document.getElementById("swimmer_id").value = user.swimmer_id;
      document.getElementById("name").value = user.name;
      document.getElementById("dob").value = user.dob;
      document.getElementById("email").value = user.email;
      document.getElementById("schoolname").value = user.schoolname;
      document.getElementById("clubname").value = user.clubname;
      document.getElementById("gender").value = user.gender;
      document.getElementById("role").value = user.role;
      document.getElementById("phone").value = user.phone;

      if (user.photoPath !== undefined) {
        document.getElementById("UploadedPhoto").src = user.photoPath;
      }
      if (user.id1Path !== undefined) {
        document.getElementById("UploadedID1").src = user.id1Path;

      }
      if (user.id2Path !== undefined) {
        document.getElementById("UploadedID2").src = user.id2Path;

      }
      // loadSwimmerData();
    }

    const UploadedPhoto = document.getElementById('UploadedPhoto');
  const image = document.getElementById('image');

  UploadedPhoto.addEventListener('change', function (e) {
    const files = e.target.files;
    if (files && files.length > 0) {
      const reader = new FileReader();
      reader.onload = function (event) {
        image.src = event.target.result;
        image.style.display = 'block';

        if (cropper) {
          cropper.destroy();
        }

        cropper = new Cropper(image, {
          aspectRatio: 1,
          viewMode: 1,
          autoCropArea: 1,
          responsive: true,
        });
      };
      reader.readAsDataURL(files[0]);
    }
  });
  });


  let cropper;
  

  function cropImage() {
    if (cropper) {
      const canvas = cropper.getCroppedCanvas({
        width: 300,
        height: 300,
      });

      // Simulate upload
      canvas.toBlob(blob => {
        const formData = new FormData();
        formData.append('croppedImage', blob);

        // Simulated upload
        console.log("Simulated upload of cropped image:", formData.get('croppedImage'));
        alert('Image cropped and ready for upload!');
      });
    }
  }

  function resetCrop() {
    if (cropper) {
      cropper.reset();
    }
  }
  // ReadCurrentProfile();

</script>

</html>